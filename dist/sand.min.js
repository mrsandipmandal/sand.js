!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SandJS={})}(this,function(t){"use strict";function e(t,e={}){if(!t)return;const r=Object.keys(e||{}),n=Object.values(e||{});try{return new Function(...r,"with(this){ return ("+t+"); }").apply(e,n)}catch(e){return void console.warn("[sandi-js] safeEval error for expression:",t,e)}}function r(t){const e=new Map,n=[];const o={get(t,o){if("__isProxy"===o)return!0;!function(t){const r=n[n.length-1];if(!r)return;let o=e.get(t);o||(o=new Set,e.set(t,o)),o.add(r)}(o);const i=Reflect.get(t,o);return i&&"object"==typeof i?r(i).proxy:i},set(t,r,n){const o=t[r],i=Reflect.set(t,r,n);return o!==n&&function(t){const r=e.get(t);r&&r.forEach(t=>t())}(r),i}};return{proxy:new Proxy(Object.assign({},t||{}),o),effect:function(t){const e=function(){try{n.push(e),t()}finally{n.pop()}};return e(),e}}}function n(t,r){const n=t.getAttribute("s-init")??t.getAttribute("x-init");n&&(t._s_inited||(t._s_inited=!0,e(n,r)))}function o(t,r){const n=t.getAttribute("s-text")??t.getAttribute("x-text");null!=n&&(t.textContent=e(n,r)??"")}function i(t,r){const n=t.getAttribute("s-html")??t.getAttribute("x-html");null!=n&&(t.innerHTML=e(n,r)??"")}function c(t,r){const n=t.getAttribute("s-effect")??t.getAttribute("x-effect");n&&r&&"function"==typeof r.__effect&&(t._s_effect_registered||(r.__effect(()=>{try{e(n,r)}catch(t){console.warn("[sandi-js] s-effect error",t)}}),t._s_effect_registered=!0))}function s(t,e){const r=t.getAttribute("s-ref")??t.getAttribute("x-ref");r&&e&&(e.$refs=e.$refs||{},e.$refs[r]=t)}function f(t){t&&t.hasAttribute&&t.hasAttribute("s-cloak")&&t.removeAttribute("s-cloak"),t&&t.hasAttribute&&t.hasAttribute("x-cloak")&&t.removeAttribute("x-cloak")}function a(t,e){const r=t.getAttribute("s-model")??t.getAttribute("x-model");if(!r)return;const n=function(t,e){if(e)return-1===e.indexOf(".")?t[e]:e.split(".").reduce((t,e)=>null==t?void 0:t[e],t)}(e,r);void 0!==n&&t.value!==String(n)&&(t.value=n),t._s_model_bound||(t.addEventListener("input",()=>{try{!function(t,e,r){if(!e)return;if(-1===e.indexOf("."))return void(t[e]=r);const n=e.split(".");let o=t;for(let t=0;t<n.length-1;t++)null==o[n[t]]&&(o[n[t]]={}),o=o[n[t]];o[n[n.length-1]]=r}(e,r,t.value)}catch(t){console.warn("[sandi-js] s-model set error",t)}}),t._s_model_bound=!0)}function l(t,e){const r=t.getAttribute("s-modelable")??t.getAttribute("x-modelable");r&&(e.$modelable=e.$modelable||{},e.$modelable[r]=e.$modelable[r]||[],e.$modelable[r].push(t))}function u(t,r){const n=t.getAttribute("s-if")??t.getAttribute("x-if");t._s_if_placeholder||(t._s_if_placeholder=document.createComment("s-if"));let o=!1;try{o=e(n,r)}catch(t){o=!1}if(o){const e=t._s_if_placeholder;e&&e.parentNode&&!t.isConnected&&e.parentNode.replaceChild(t,e)}else if(t.isConnected){const e=t._s_if_placeholder;t.parentNode&&t.parentNode.replaceChild(e,t)}else!t._s_if_placeholder.parentNode&&t.parentNode&&t.parentNode.insertBefore(t._s_if_placeholder,t)}function d(t,r){const n=t.getAttribute("s-show")??t.getAttribute("x-show");if(null==n)return;const o=e(n,r);t.style.display=o?"":"none"}function h(t,r){const n=t.getAttribute("s-bind")??t.getAttribute("x-bind");n&&n.split(",").map(t=>t.trim()).filter(Boolean).forEach(n=>{const o=n.split(":");if(o.length<2)return;const i=o.shift().trim(),c=e(o.join(":").trim(),r);try{t[i]=c}catch{t.setAttribute(i,c)}})}function b(t,r){if("TEMPLATE"!==t.tagName)return;const n=t.getAttribute("s-for")??t.getAttribute("x-for");if(!n)return;const o=n.match(/^\s*(?:\(([^)]+)\)|([^ ]+))\s+in\s+(.+)$/);if(!o)return;const i=(o[1]||o[2]).split(",")[0].trim(),c=o[3].trim(),s=t.parentNode;if(!s)return;t._marker||(t._marker=document.createComment("s-for"),s.insertBefore(t._marker,t)),t._prev||(t._prev=[]);let f=[];try{f=e(c,r)||[]}catch(t){f=[]}(t._prev||[]).forEach(t=>t.parentNode&&t.parentNode.removeChild(t)),t._prev=[],f.forEach((e,n)=>{const o=t.content.cloneNode(!0),c=Object.create(r);c[i]=e,c.$index=n,s.insertBefore(o,t._marker);const f=t.content.childNodes.length,a=[];let l=t._marker.previousSibling;for(let t=0;t<f&&l;t++)a.push(l),l=l.previousSibling;a.reverse().forEach(e=>t._prev.push(e))})}function p(t,r,n){if(!n)return;let o;if(n.startsWith("@"))o=n.slice(1);else{if(!n.startsWith("s-on:")&&!n.startsWith("x-on:"))return;o=n.slice(5)}const i=t.getAttribute(n);if(!i)return;const c=`_s_on_${o}`;t[c]||(t.addEventListener(o,t=>{try{e(i,Object.assign(Object.create(r),{$event:t}))}catch(t){console.warn("[sandi-js] s-on handler error",t)}}),t[c]=!0)}function m(t){const e=t.getAttribute("s-transition")??t.getAttribute("x-transition")??"all 150ms ease";t.style.transition=e}function _(t){const e=t.getAttribute("s-teleport")??t.getAttribute("x-teleport");if(!e)return;t._ph||(t._ph=document.createComment("s-teleport"));const r=document.querySelector(e);r&&(t._teleported||(t.parentNode&&t.parentNode.insertBefore(t._ph,t),r.appendChild(t),t._teleported=!0))}let y=0;function g(t){const e=t.getAttribute("s-id")??t.getAttribute("x-id")??"s-id";t.id||(t.id=`${e}-${++y}`)}const A=["s-","x-"];function x(t,e){return A.some(r=>t.hasAttribute(r+e))}function v(t,e){for(const r of A){const n=t.getAttribute(r+e);if(null!=n)return n}return null}const j=(()=>{let t=[],e=!1;return{schedule:function(r){"function"==typeof r&&(t.push(r),e||(e=!0,Promise.resolve().then(()=>{const r=t.slice();t=[],r.forEach(t=>{try{t()}catch(t){console.error("[sandi-js] job error",t)}}),e=!1}).catch(r=>{e=!1,t=[],console.error("[sandi-js] scheduler error",r)})))}}})();function $(t=document.body){if(!t||!t.querySelectorAll)return;const y=A.map(t=>`[${t}data]`).join(",");t.querySelectorAll(y).forEach(t=>{const y=r(e(v(t,"data")||"{}",{})||{}),$=y.proxy;$.$refs=$.$refs||{},$.$modelable=$.$modelable||{},$.__effect=t=>y.effect(t);const w=v(t,"init");if(w)try{e(w,$)}catch(t){console.warn("[sandi-js] s-init error",t)}var N,E;y.effect(()=>{j.schedule(()=>function(t,e){k(t,t=>{if(1!==t.nodeType)return;try{if(x(t,"ignore"))return!0}catch(t){}if(x(t,"ref"))try{s&&s(t,e)}catch(t){}if(x(t,"id"))try{g&&g(t)}catch(t){}if(x(t,"cloak"))try{f&&f(t)}catch(t){}if(x(t,"text"))try{o&&o(t,e)}catch(t){}if(x(t,"html"))try{i&&i(t,e)}catch(t){}if(x(t,"show"))try{d&&d(t,e)}catch(t){}if(x(t,"bind"))try{h&&h(t,e)}catch(t){}if(x(t,"if")){try{u&&u(t,e)}catch(t){}if(!t.isConnected)return!0}if(x(t,"for")){try{b&&b(t,e)}catch(t){}if(!t.isConnected)return!0}if(x(t,"model"))try{a&&a(t,e)}catch(t){}if(x(t,"modelable"))try{l&&l(t,e)}catch(t){}if(x(t,"effect"))try{c&&c(t,e)}catch(t){}if(x(t,"teleport")){try{_&&_(t)}catch(t){}if(!t.isConnected)return!0}if(x(t,"transition"))try{m&&m(t)}catch(t){}if(x(t,"init"))try{n&&n(t,e)}catch(t){}const r=t.attributes||[];for(let n=0;n<r.length;n++){const o=r[n];if(!o)continue;const i=o.name;if(i.startsWith("@")||i.startsWith("s-on:")||i.startsWith("x-on:"))try{p&&p(t,e,i)}catch(t){console.warn("[sandi-js] s-on",t)}}})}(t,$))}),N=t,E="data",A.forEach(t=>N.removeAttribute(t+E)),t.querySelectorAll("[s-cloak],[x-cloak]").forEach(t=>t.removeAttribute("s-cloak")),t.hasAttribute("s-cloak")&&t.removeAttribute("s-cloak"),t.hasAttribute("x-cloak")&&t.removeAttribute("x-cloak")})}function k(t,e){if(!0===e(t))return;const r=Array.from(t.childNodes||[]);for(let t=0;t<r.length;t++){const n=r[t];if(1===n.nodeType)k(n,e);else try{e(n)}catch(t){}}}"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>$()):$());var w={mount:$};t.default=w,t.mount=$,Object.defineProperty(t,"__esModule",{value:!0})});
