!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SandJS={})}(this,function(t){"use strict";function e(t){const n=new Map,r=[];const o={get(t,o){if("__isProxy"===o)return!0;!function(t){const e=r[r.length-1];if(!e)return;let o=n.get(t);o||(o=new Set,n.set(t,o)),o.add(e)}(o);const s=Reflect.get(t,o);return s&&"object"==typeof s?e(s).proxy:s},set(t,e,r){const o=t[e],s=Reflect.set(t,e,r);return o!==r&&function(t){const e=n.get(t);e&&e.forEach(t=>t())}(e),s}};return{proxy:new Proxy(Object.assign({},t||{}),o),effect:function(t){const e=function(){try{r.push(e),t()}finally{r.pop()}};return e(),e}}}function n(t,e={}){if(!t)return;const n=Object.keys(e||{}),r=Object.values(e||{});try{return new Function(...n,"with(this) { return ("+t+"); }").apply(e,r)}catch(e){return void console.warn("[sandi-js] safeEval error for expression:",t,e)}}function r(t){try{return t&&t.hasAttribute&&t.hasAttribute("s-ignore")}catch(t){return!1}}function o(t,e,r){if(!r)return;let o;if(r.startsWith("@"))o=r.slice(1);else{if(!r.startsWith("s-on:"))return;o=r.slice(5)}const s=t.getAttribute(r);if(!s)return;const i=`_s_on_${o}`;t[i]||(t.addEventListener(o,t=>{try{n(s,Object.assign(Object.create(e),{$event:t}))}catch(t){console.warn("[sandi-js] s-on handler error",t)}}),t[i]=!0)}let s=0;function i(t=document.body){t.querySelectorAll("[s-data]").forEach(t=>{const i=e(n(t.getAttribute("s-data"),{})||{}),a=i.proxy;if(a.$refs=a.$refs||{},a.$modelable=a.$modelable||{},a.__effect=t=>i.effect(t),t.hasAttribute("s-init"))try{!function(t,e){const r=t.getAttribute("s-init");r&&(t._s_inited||(t._s_inited=!0,n(r,e)))}(t,a)}catch(t){console.warn("[sandi-js] s-init error",t)}i.effect(()=>{Object.keys(i.proxy).forEach(t=>a[t]=i.proxy[t]),function(t,e){c(t,t=>{if(1!==t.nodeType)return;try{if(r(t))return}catch(t){}t.hasAttribute("s-ref")&&function(t,e){const n=t.getAttribute("s-ref");n&&e&&(e.$refs=e.$refs||{},e.$refs[n]=t)}(t,e),t.hasAttribute("s-id")&&function(t){const e=t.getAttribute("s-id")||"s-id";t.id||(t.id=`${e}-${++s}`)}(t),t.hasAttribute("s-cloak")&&function(t){t&&t.hasAttribute&&t.hasAttribute("s-cloak")&&t.removeAttribute("s-cloak")}(t),t.hasAttribute("s-text")&&function(t,e){const r=t.getAttribute("s-text");t.textContent=n(r,e)??""}(t,e),t.hasAttribute("s-html")&&function(t,e){const r=n(t.getAttribute("s-html"),e);t.innerHTML=null==r?"":r}(t,e),t.hasAttribute("s-show")&&function(t,e){const r=n(t.getAttribute("s-show"),e);t.style.display=r?"":"none"}(t,e),t.hasAttribute("s-bind")&&function(t,e){const r=t.getAttribute("s-bind");if(!r)return;r.split(",").map(t=>t.trim()).filter(Boolean).forEach(r=>{const o=r.split(":");if(o.length<2)return;const s=o.shift().trim(),i=n(o.join(":").trim(),e);try{t[s]=i}catch{t.setAttribute(s,i)}})}(t,e),t.hasAttribute("s-if")&&function(t,e){let r;t._s_if_placeholder||(t._s_if_placeholder=document.createComment("s-if"));try{r=n(t.getAttribute("s-if"),e)}catch(t){r=!1}if(r){const e=t._s_if_placeholder;e&&e.parentNode&&!t.isConnected&&e.parentNode.replaceChild(t,e)}else if(t.isConnected){const e=t._s_if_placeholder;t.parentNode&&t.parentNode.replaceChild(e,t)}else!t._s_if_placeholder.parentNode&&t.parentNode&&t.parentNode.insertBefore(t._s_if_placeholder,t)}(t,e),t.hasAttribute("s-effect")&&function(t,e){const r=t.getAttribute("s-effect");r&&e&&"function"==typeof e.__effect&&(t._s_effect_registered||(e.__effect(()=>{try{n(r,e)}catch(t){console.warn("[sandi-js] s-effect error",t)}}),t._s_effect_registered=!0))}(t,e),t.hasAttribute("s-model")&&function(t,e){const n=t.getAttribute("s-model");if(n){try{const r=function(t,e){if(e)return-1===e.indexOf(".")?t[e]:e.split(".").reduce((t,e)=>null==t?void 0:t[e],t)}(e,n);void 0!==r&&t.value!==String(r)&&(t.value=r)}catch(t){}t._s_model_bound||(t.addEventListener("input",()=>{try{!function(t,e,n){if(!e)return;if(-1===e.indexOf("."))return void(t[e]=n);const r=e.split(".");let o=t;for(let t=0;t<r.length-1;t++){const e=r[t];null==o[e]&&(o[e]={}),o=o[e]}o[r[r.length-1]]=n}(e,n,t.value)}catch(t){console.warn("[sandi-js] s-model set error",t)}}),t._s_model_bound=!0)}}(t,e),t.hasAttribute("s-modelable")&&function(t,e){const n=t.getAttribute("s-modelable");n&&(e.$modelable[n]=t)}(t,e),t.hasAttribute("s-teleport")&&function(t){const e=t.getAttribute("s-teleport");if(!e)return;t._s_teleport_placeholder||(t._s_teleport_placeholder=document.createComment("s-teleport"));const n=document.querySelector(e);n&&(t._s_teleported||(t.parentNode&&!t._s_teleport_placeholder.parentNode&&t.parentNode.insertBefore(t._s_teleport_placeholder,t),n.appendChild(t),t._s_teleported=!0))}(t),t.hasAttribute("s-transition")&&function(t){const e=t.getAttribute("s-transition")||"all 150ms ease";t.style.transition=e}(t);const i=t.attributes||[];for(let n=0;n<i.length;n++){const r=i[n];r&&((r.name.startsWith("@")||r.name.startsWith("s-on:"))&&o(t,e,r.name))}})}(t,a)}),t.removeAttribute("s-data"),t.querySelectorAll("[s-cloak]").forEach(t=>t.removeAttribute("s-cloak")),t.hasAttribute("s-cloak")&&t.removeAttribute("s-cloak")})}function c(t,e){if(e(t),1!==t.nodeType)return;try{if(r(t))return}catch(t){}const n=Array.from(t.childNodes||[]);for(let t=0;t<n.length;t++)c(n[t],e)}"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>i()):i());var a={mount:i,createReactive:e};t.createReactive=e,t.default=a,t.mount=i,Object.defineProperty(t,"__esModule",{value:!0})});
